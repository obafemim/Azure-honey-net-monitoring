# Azure Honeynet Monitoring Project

This project demonstrates the construction of a **mini honeynet** in **Microsoft Azure**, where logs are ingested into a **Log Analytics Workspace** and used by **Microsoft Sentinel** to build attack maps, trigger alerts, and create incidents. The project involves measuring security metrics for 24 hours in an **insecure environment**, applying **security controls**, and then measuring metrics for another 24 hours to evaluate the effectiveness of the applied controls.

## Table of Contents
1. [Overview](#overview)
2. [Technologies Used](#technologies-used)
3. [Architecture](#architecture)
   - [Architecture Before Hardening](#architecture-before-hardening)
   - [Architecture After Hardening](#architecture-after-hardening)
4. [Attack Maps](#attack-maps)
   - [Attack Maps Before Hardening](#attack-maps-before-hardening)
   - [Attack Maps After Hardening](#attack-maps-after-hardening)
5. [Metrics](#metrics)
   - [Metrics Before Hardening](#metrics-before-hardening)
   - [Metrics After Hardening](#metrics-after-hardening)
6. [Summary](#summary)
7. [KQL Queries](#kql-queries)

---

## Overview
In this project, a **mini honeynet** was deployed in Microsoft Azure. The logs from various components were ingested into a **Log Analytics Workspace**, which was integrated with **Microsoft Sentinel** to monitor the environment. Metrics were measured before and after applying security controls, focusing on the following areas:
- **SecurityEvent**: Windows Event Logs
- **Syslog**: Linux Event Logs
- **SecurityAlert**: Alerts triggered in Log Analytics
- **SecurityIncident**: Incidents created by Microsoft Sentinel
- **AzureNetworkAnalytics_CL**: Malicious flows allowed into the honeynet

---

## Technologies Used
- **Microsoft Azure**: For deploying the virtual machines and network components.
- **Microsoft Sentinel**: For building attack maps, triggering alerts, and creating incidents.
- **Log Analytics Workspace**: For ingesting logs and monitoring security events.
- **Azure Key Vault**: For securing secrets and sensitive information.
- **Azure Storage Account**: For storing data logs.
- **Network Security Group (NSG)**: For controlling network traffic.
- **Virtual Machines (Windows & Linux)**: For generating security events.

---

## Architecture

### Architecture Before Hardening
The initial architecture of the honeynet in Azure was set up with the following components:
- **Virtual Network (VNet)**
- **Network Security Group (NSG)**
- **Virtual Machines**: 2 Windows VMs, 1 Linux VM
- **Log Analytics Workspace**
- **Azure Key Vault**
- **Azure Storage Account**
- **Microsoft Sentinel**

![Architecture Before Hardening](images/Cloud%20Honeynet%20%26%20SOC%20Integration%20-%20Pre-Hardening%20Architecture.png)

### Architecture After Hardening
After applying security controls, the architecture remained the same, but security policies were strengthened to reduce malicious activity and vulnerabilities in the environment.

![Architecture After Hardening](images/Cloud%20Honeynet%20%26%20SOC%20Integration%20-%20Post-Hardening%20Architecture.png)

---

## Attack Maps

### Attack Maps Before Hardening
The attack maps generated by **Microsoft Sentinel** before applying security controls indicated multiple instances of suspicious or malicious activity within the network.

![Attack Map 1 Before Hardening](images/Screenshot%202024-09-14%20183814.png)
![Attack Map 2 Before Hardening](images/Screenshot%202024-09-14%20183945.png)
![Attack Map 3 Before Hardening](images/Screenshot%202024-09-14%20184006.png)
![Attack Map 3 Before Hardening](images/Screenshot%202024-09-14%20184029.png)

### Attack Maps After Hardening
After hardening the environment, the attack maps showed no malicious activity within the 24-hour period.

![Attack Maps After Hardening](images/Screenshot%202024-09-18%20230920.png)

---

## Metrics

### Metrics Before Hardening
The following table shows the security metrics collected from the **insecure environment** over a 24-hour period:

| Metric                     | Count |
|-----------------------------|-------|
| **SecurityEvent** (Windows)  | 7671  |
| **Syslog** (Linux)           | 833   |
| **SecurityAlert**            | 4     |
| **SecurityIncident**         | 59    |
| **AzureNetworkAnalytics_CL** | 620   |

---

### Metrics After Hardening
After applying security controls, the number of security events and incidents decreased significantly, as shown in the table below. These metrics were collected for another 24-hour period after hardening the environment.

| Metric                     | Count |
|-----------------------------|-------|
| **SecurityEvent** (Windows)  | 3894  |
| **Syslog** (Linux)           | 6     |
| **SecurityAlert**            | 0     |
| **SecurityIncident**         | 0     |
| **AzureNetworkAnalytics_CL** | 0     |

---

## Summary
This project successfully demonstrated the value of deploying a **honeynet** in **Microsoft Azure** and integrating it with **Log Analytics Workspace** and **Microsoft Sentinel** for monitoring. The project measured key security metrics in both insecure and hardened environments, showing a drastic reduction in security incidents and malicious activity after applying security controls.

---

## KQL Queries
Below are the **KQL queries** used to collect the metrics from the Log Analytics Workspace.

### Start/Stop Time
```kql
range x from 1 to 1 step 1
| project StartTime = ago(24h), StopTime = now()

SecurityEvent
| where TimeGenerated >= ago(24h)
| count

Syslog
| where TimeGenerated >= ago(24h)
| count

SecurityAlert
| where DisplayName !startswith "CUSTOM" and DisplayName !startswith "TEST"
| where TimeGenerated >= ago(24h)
| count

SecurityIncident
| where TimeGenerated >= ago(24h)
| count

AzureNetworkAnalytics_CL
| where FlowType_s == "MaliciousFlow" and AllowedInFlows_d > 0
| where TimeGenerated >= ago(24h)
| count
